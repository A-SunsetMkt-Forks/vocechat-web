"use strict";(globalThis.webpackChunkrustchat_web=globalThis.webpackChunkrustchat_web||[]).push([[379],{9930:(e,t,i)=>{i.d(t,{Z:()=>o});var n,s=i(7313);function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r.apply(this,arguments)}const a=(e,t)=>{let{title:i,titleId:a,...o}=e;return s.createElement("svg",r({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},o),i?s.createElement("title",{id:a},i):null,n||(n=s.createElement("path",{d:"M8.11904 0C3.91105 0 0.5 3.41105 0.5 7.61905C0.5 11.827 3.91105 15.2381 8.11904 15.2381C12.3271 15.2381 15.7381 11.827 15.7381 7.61905C15.7381 3.41105 12.3263 0 8.11904 0ZM11.7053 10.128L10.628 11.2053L8.11904 8.69714L5.61009 11.2053L4.53277 10.128L7.04095 7.61905L4.532 5.1101L5.60934 4.03353L8.11829 6.54248L10.6272 4.03353L11.7045 5.1101L9.19638 7.61905L11.7053 10.128Z",fill:"#6C737F"})))},o=(0,s.forwardRef)(a)},6544:(e,t,i)=>{i.d(t,{Z:()=>o});var n,s=i(7313);function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r.apply(this,arguments)}const a=(e,t)=>{let{title:i,titleId:a,...o}=e;return s.createElement("svg",r({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},o),i?s.createElement("title",{id:a},i):null,n||(n=s.createElement("path",{d:"M16.5303 11.7204L16.4462 11.6478C16.1526 11.4299 15.7359 11.4541 15.4697 11.7204L12.7503 14.4397L12.75 7.75003L12.7432 7.64826C12.6935 7.28218 12.3797 7.00003 12 7.00003L11.8982 7.00688C11.5322 7.05654 11.25 7.37033 11.25 7.75003L11.2503 14.4417L8.52961 11.7198L8.4455 11.6472C8.15193 11.4293 7.73527 11.4534 7.46895 11.7196C7.176 12.0124 7.17591 12.4873 7.46875 12.7803L11.4687 16.7818L11.5529 16.8544C11.8465 17.0724 12.2632 17.0482 12.5295 16.7819L16.5303 12.7811L16.6029 12.6969C16.8208 12.4033 16.7966 11.9867 16.5303 11.7204ZM6.25 3C4.45507 3 3 4.45507 3 6.25V17.75C3 19.5449 4.45507 21 6.25 21H17.75C19.5449 21 21 19.5449 21 17.75V6.25C21 4.45507 19.5449 3 17.75 3H6.25ZM4.5 6.25C4.5 5.2835 5.2835 4.5 6.25 4.5H17.75C18.7165 4.5 19.5 5.2835 19.5 6.25V17.75C19.5 18.7165 18.7165 19.5 17.75 19.5H6.25C5.2835 19.5 4.5 18.7165 4.5 17.75V6.25Z",fill:"#616161"})))},o=(0,s.forwardRef)(a)},7275:(e,t,i)=>{i.d(t,{Z:()=>o});var n,s=i(7313);function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r.apply(this,arguments)}const a=(e,t)=>{let{title:i,titleId:a,...o}=e;return s.createElement("svg",r({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},o),i?s.createElement("title",{id:a},i):null,n||(n=s.createElement("path",{d:"M14.2958 16.2945C13.9055 16.6853 13.906 17.3184 14.2968 17.7087C14.6876 18.0989 15.3207 18.0985 15.711 17.7077L20.7076 12.7043C21.0976 12.3137 21.0974 11.681 20.7072 11.2906L15.7106 6.29297C15.3201 5.9024 14.6869 5.90234 14.2964 6.29282C13.9058 6.6833 13.9057 7.31647 14.2962 7.70703L17.589 11H11C6.66509 11 3.13546 14.4478 3.00381 18.7508L3 19C3 19.5523 3.44772 20 4 20C4.55228 20 5 19.5523 5 19C5 15.7616 7.56557 13.1224 10.7751 13.0041L11 13H17.586L14.2958 16.2945Z",fill:"#667085"})))},o=(0,s.forwardRef)(a)},3487:(e,t,i)=>{i.d(t,{Z:()=>p});var n=i(7313),s=i(9184),r=i(8570),a=i(5290),o=i(5607),l=i(6417);const c=s.F4`
from{
background: transparent;
}
to{
  background: rgba(1, 1, 1, 0.9);
}
`,d=s.ZP.div`
  /* todo */
  transition: all 0.5s ease;
  width: 100vw;
  height: 100vh;
  /* background-color: rgba(1, 1, 1, 0.9); */
  animation: ${c} 0.3s ease-in-out forwards;
  display: flex;
  align-items: center;
  justify-content: center;
  .box {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 10px;
    img {
      max-width: 70vw;
      max-height: 80vh;
    }
    .origin {
      font-weight: bold;
      font-size: 14px;
      color: #aaa;
      &:hover {
        text-decoration: underline;
        color: #fff;
      }
    }
  }
`;function p(e){let{download:t=!0,data:i=null,closeModal:s}=e;const c=(0,n.useRef)();if((0,r.O)(c,s),(0,a.z)("Escape",(()=>{s()}),{eventTypes:["keyup"]}),!i)return null;const{originUrl:p,downloadLink:f,name:u,type:h}=i;return(0,l.jsx)(o.Z,{children:(0,l.jsx)(d,{children:(0,l.jsxs)("div",{className:"box",ref:c,children:[(0,l.jsx)("img",{src:p,alt:"preview image",className:"animate__animated animate__fadeIn animate__faster"}),t&&(0,l.jsx)("a",{className:"origin",download:u,type:h,href:f||p,rel:"noreferrer",children:"Download original"})]})})})}},4379:(e,t,i)=>{i.d(t,{Z:()=>p});var n=i(7313),s=i(9184),r=i(7323),a=i(8039),o=i(5536),l=i(5664),c=i(6417);const d=s.ZP.div`
  display: flex;
  flex-direction: column;
  border-radius: var(--br);
  background-color: #f4f4f5;
`,p=e=>{let{id:t}=e;const{favorites:i}=(0,l.Z)({}),[s,p]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const e=i.find((e=>e.id==t)),{messages:n}=e||{};if(n){const e=n.map((e=>{let{from_mid:t}=e;return t}))||[];p((0,c.jsx)(d,{"data-favorite-mids":e.join(","),className:"favorite",children:(0,c.jsx)("div",{className:"list",children:n.map(((e,t)=>{const{user:i={},download:n,content:s,content_type:l,properties:d,thumbnail:p}=e;return(0,c.jsxs)(r.Z,{className:"archive",children:[i&&(0,c.jsx)("div",{className:"avatar",children:(0,c.jsx)(o.Z,{url:i.avatar,name:i.name})}),(0,c.jsxs)("div",{className:"details",children:[(0,c.jsx)("div",{className:"up",children:(0,c.jsx)("span",{className:"name",children:null===i||void 0===i?void 0:i.name})}),(0,c.jsx)("div",{className:"down",children:(0,a.Z)({download:n,content:s,content_type:l,properties:d,thumbnail:p})})]})]},t)}))})}))}}),[i,t]),t?s:null}},780:(e,t,i)=>{i.d(t,{Z:()=>c});var n=i(3709),s=i(2963),r=i(1902),a=i(9184),o=i(6417);const l=a.ZP.span`
  padding: 0 2px;
  color: #1fe1f9;
  &.clickable {
    cursor: pointer;
  }
`;function c(e){let{uid:t,popover:i=!0,cid:a}=e;const c=(0,n.v9)((e=>e.contacts.byId))[t];return c?(0,o.jsx)(s.ZP,{disabled:!i,interactive:!0,placement:"top",trigger:"click",content:(0,o.jsx)(r.Z,{uid:t,type:"card",cid:a}),children:(0,o.jsx)(l,{className:i?"clickable":"",children:`@${c.name}`})}):null}},8039:(e,t,i)=>{i.d(t,{Z:()=>A});var n=i(7313),s=i(4385),r=i(658),a=i.n(r),o=i(2867),l=i(780),c=i(9184),d=i(7323),p=i(5536),f=i(7275),u=i(1958),h=i(6417);const x=c.ZP.div`
  display: flex;
  flex-direction: column;
  border-radius: var(--br);
  background-color: #f4f4f5;
  > .tip {
    padding: 8px 8px 0 8px;
    display: flex;
    align-items: center;
    gap: 4px;
    .icon {
      width: 16px;
      height: 16px;
      path {
        fill: #98a2b3;
      }
    }
    font-weight: 400;
    font-size: 12px;
    line-height: 18px;
    color: #98a2b3;
  }
`,g=e=>{let{context:t,to:i,from_uid:s,id:r}=e;const{normalizeMessage:a,messages:o}=(0,u.Z)(),[l,c]=(0,n.useState)(null);return(0,n.useEffect)((()=>{r&&a(r)}),[r]),(0,n.useEffect)((()=>{if(o){const e=o.map((e=>{let{from_mid:t}=e;return t}))||[];c((0,h.jsxs)(x,{"data-forwarded-mids":e.join(","),children:[(0,h.jsxs)("h4",{className:"tip",children:[(0,h.jsx)(f.Z,{className:"icon"}),"Forwarded"]}),(0,h.jsx)("div",{className:"list",children:o.map(((e,n)=>{const{user:r={},download:a,content:o,content_type:l,properties:c,thumbnail:f}=e;return(0,h.jsxs)(d.Z,{className:"archive",children:[r&&(0,h.jsx)("div",{className:"avatar",children:(0,h.jsx)(p.Z,{url:r.avatar,name:r.name})}),(0,h.jsxs)("div",{className:"details",children:[(0,h.jsx)("div",{className:"up",children:(0,h.jsx)("span",{className:"name",children:null===r||void 0===r?void 0:r.name})}),(0,h.jsx)("div",{className:"down",children:A({download:a,context:t,to:i,from_uid:s,content:o,content_type:l,properties:c,thumbnail:f})})]})]},n)}))})]}))}}),[o,t,i,s]),r?l:null};var m=i(9083),v=i(9694),w=i.n(v),b=i(3709);const y=c.ZP.div`
  background: #f3f4f6;
  border: 1px solid #d4d4d4;
  box-sizing: border-box;
  border-radius: 6px;
  width: 370px;
  height: 66px;
  /* height: fit-content; */
  &.sending {
    /* opacity: 0.9; */
  }
  * {
    user-select: text;
  }
  .basic {
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    .icon {
      width: 36px;
      height: 48px;
    }
    .info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      width: 100%;
      overflow: hidden;
      .name {
        font-weight: 600;
        font-size: 14px;
        line-height: 20px;
        color: #1c1c1e;
        white-space: nowrap;
        text-overflow: ellipsis;
      }
      .details {
        white-space: nowrap;
        font-weight: 400;
        font-size: 12px;
        line-height: 18px;
        color: #616161;
        display: flex;
        gap: 16px;
        .from strong {
          font-weight: bold;
        }
      }
    }
    .download {
      white-space: nowrap;
    }
    .cancel {
      cursor: pointer;
    }
  }
`;var j=i(6890),_=(i(7243),i(4711));const k=c.ZP.div`
  position: relative;
  width: fit-content;
  height: fit-content;
  img {
    object-fit: cover;
  }
  .overlay {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    .progress {
      width: 15px;
      height: 15px;
      .CircularProgressbar-path {
        stroke: #444;
      }
    }
  }
`;function Z(e){let{uploading:t,progress:i,thumbnail:s,download:r,content:a,properties:o={}}=e;const[l,c]=(0,n.useState)(s),{width:d=0,height:p=0}=(0,_.CW)(o);return(0,n.useEffect)((()=>{const e=s,t=new Image;t.onload=()=>{c(e)},t.onerror=()=>{c("")},t.src=e}),[s]),(0,h.jsxs)(k,{children:[t&&(0,h.jsx)("div",{className:"overlay",children:(0,h.jsx)("div",{className:"progress",children:(0,h.jsx)(j.Ip,{value:i,strokeWidth:50,styles:(0,j.y3)({storke:"#000",strokeLinecap:"butt"})})})}),(0,h.jsx)("img",{className:"img preview",style:{width:d?`${d}px`:"",height:p?`${p}px`:""},"data-meta":JSON.stringify(o),"data-origin":a,"data-download":r,src:l})]})}var N=i(3247),L=i(445),C=i(5106);var E=i(1808),S=i(6475);const z=c.ZP.div`
  background: #ecfdff;
  border-radius: 4px;
  height: 8px;
  overflow: hidden;
  .progress {
    transition: all 0.25s ease;
    height: 8px;
    background: #088ab2;
    border-radius: 4px;
  }
`;function $(e){let{value:t,width:i="100%"}=e;return(0,h.jsx)(z,{style:{width:i},children:(0,h.jsx)("div",{className:"progress",style:{width:`${t}%`}})})}var P=i(6544),F=i(9930);a().extend(w());const M=e=>e&&"string"==typeof e&&e.startsWith("blob:");function R(e){let{context:t="",to:i=null,created_at:s,from_uid:r=null,content:o="",download:l="",thumbnail:c="",properties:d={local_id:0,name:"",size:0,content_type:""}}=e;const[p,f]=(0,n.useState)(null),[u,x]=(0,n.useState)(!1),g=function(e){let{context:t="user",id:i=0}=e;const n=(0,b.I0)(),s="channel"==t?L.nF:C.Fs;return e=>{n(s({id:i,mid:e})),n((0,N.Gd)(e))}}({context:t,id:i}),{sendMessage:m,isSuccess:v,isSending:w}=(0,S.Z)({context:t,from:r,to:i}),{stopUploading:j,data:k,uploadFile:z,progress:R,isSuccess:I}=(0,E.Z)(),O=(0,b.v9)((e=>e.contacts.byId[r])),{size:U,name:D,content_type:H}=null!==d&&void 0!==d?d:{};(0,n.useEffect)((()=>{M(o)&&(async e=>{let{url:t,name:i,type:n}=e;try{if(x(!0),n.startsWith("image")){const e=await(0,_.Ad)(t);f(e)}let e=await fetch(t).then((e=>e.blob())).then((e=>new File([e],i,{type:n})));await z(e),x(!1)}catch(s){x(!1)}})({url:o,name:D,type:H})}),[o,D,H]),(0,n.useEffect)((()=>{const e=null!==d&&void 0!==d?d:{},t=p?{...e,...p}:e;if(I&&M(o)){const{path:e}=k;m({ignoreLocal:!0,type:"file",content:{path:e},properties:t})}}),[I,k,d,o]),(0,n.useEffect)((()=>{v&&URL.revokeObjectURL(o)}),[v,o]);if(!d)return null;const T=(0,_.LP)(H,D);if(!o||!D)return null;const A=u||w;return(0,_.Or)(H,U)?(0,h.jsx)(Z,{uploading:A,progress:R,properties:{...p,...d},size:U,content:o,download:l,thumbnail:c},null===d||void 0===d?void 0:d.local_id):(0,h.jsx)(y,{className:"file_message "+(A?"sending":""),children:(0,h.jsxs)("div",{className:"basic",children:[T,(0,h.jsxs)("div",{className:"info",children:[(0,h.jsx)("span",{className:"name",children:D}),(0,h.jsx)("span",{className:"details",children:A?(0,h.jsx)($,{value:R,width:"80%"}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("i",{className:"size",children:(0,_.td)(U)}),(0,h.jsx)("i",{className:"time",children:a()(s).fromNow()}),O&&(0,h.jsxs)("i",{className:"from",children:["by ",(0,h.jsx)("strong",{children:O.name})]})]})})]}),A?(0,h.jsx)(F.Z,{className:"cancel",onClick:()=>{j(),URL.revokeObjectURL(o),g(d.local_id)}}):(0,h.jsx)("a",{className:"download",download:D,href:`${o}&download=true`,children:(0,h.jsx)(P.Z,{})})]})})}var I=i(5843);const O=c.ZP.a`
  background: #f3f4f6;
  border: 1px solid #d4d4d4;
  box-sizing: border-box;
  border-radius: 6px;
  padding: 12px 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  width: 380px;
  .favicon {
    display: flex;
    width: 48px;
    height: 48px;
    border-radius: 4px;
    img {
      /* width: 100%;
      height: 100%; */
      object-fit: contain;
    }
  }
  .info {
    display: flex;
    flex-direction: column;
    .title {
      font-style: normal;
      font-weight: 600;
      font-size: 14px;
      line-height: 20px;
      color: #1c1c1e;
    }
    .desc {
      font-weight: 500;
      font-size: 12px;
      line-height: 18px;
      color: #616161;
    }
    .link {
      font-weight: 400;
      font-size: 10px;
      line-height: 18px;
      color: #616161;
    }
    .dots {
      width: 288px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,U=c.ZP.a`
  width: 380px;
  padding: 12px;
  background: #f3f4f6;
  border: 1px solid #d4d4d4;
  box-sizing: border-box;
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  .title {
    font-weight: 600;
    font-size: 16px;
    line-height: 24px;
    color: #06aed4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .desc {
    font-weight: 400;
    font-size: 12px;
    line-height: 18px;
    color: #616161;
    margin-bottom: 8px;
    width: 356px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .image {
    width: 100%;
    height: 180px;
    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }
`;function D(e){let{url:t=""}=e;const[i,s]=(0,n.useState)(""),[r]=(0,I.rf)(),[a,o]=(0,n.useState)(null);(0,n.useEffect)((()=>{(async e=>{var t;const{data:i}=await r(e),n=i.title||i.site_name,a=i.description,l=(null===(t=i.images.find((e=>!!e.url)))||void 0===t?void 0:t.url)||"",c=i.favicon_url||`${new URL(e).origin}/favicon.ico`;s(c),o({title:n,description:a,ogImage:l})})(t)}),[t]);if(!t||!a||!a.title)return null;const{title:l,description:c,ogImage:d}=a;return d?(0,h.jsxs)(U,{href:t,target:"_blank",children:[(0,h.jsx)("h3",{className:"title",children:l}),(0,h.jsx)("p",{className:"desc dots",children:c}),(0,h.jsx)("div",{className:"image",children:(0,h.jsx)("img",{src:d,alt:"og image"})})]}):(0,h.jsxs)(O,{href:t,target:"_blank",children:[i&&(0,h.jsx)("div",{className:"favicon",children:(0,h.jsx)("img",{onError:()=>{s("")},src:i,alt:"favicon"})}),(0,h.jsxs)("div",{className:"info",children:[(0,h.jsx)("h3",{className:"title",children:l}),(0,h.jsx)("p",{className:"desc dots",children:c}),(0,h.jsx)("span",{className:"link dots",children:t})]})]})}var H=i(7560),T=i.n(H);const A=e=>{let{context:t=null,to:i=null,from_uid:r,created_at:c,properties:d,content_type:p,content:f,download:u,thumbnail:x,edited:v=!1}=e,w=null;switch(p){case o.bT.text:w=(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(s.Z,{componentDecorator:(e,t,i)=>(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)("a",{className:"link",target:"_blank",href:e,rel:"noreferrer",children:t},i),!e.startsWith("mailto")&&(0,h.jsx)(D,{url:e})]},i),children:T()(f,/(\s{1}@[0-9]+\s{1})/g,((e,t)=>{const n=e.trim().slice(1);return(0,h.jsx)(l.Z,{uid:n,cid:i},t)}))}),v&&(0,h.jsx)("span",{className:"edited",title:a()(v).format("YYYY-MM-DD h:mm:ss A"),children:"(edited)"})]});break;case o.bT.markdown:w=(0,h.jsx)(m.Z,{content:f});break;case o.bT.file:w=(0,h.jsx)(R,{properties:d,context:t,to:i,download:u,thumbnail:x,from_uid:r,created_at:c,content:f});break;case o.bT.archive:w=(0,h.jsx)(g,{properties:d,context:t,to:i,from_uid:r,created_at:c,id:f,thumbnail:x})}return w}},7323:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i(9184).ZP.div`
  position: relative;
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 4px 8px;
  margin: 8px 0;
  border-radius: 8px;
  /* content-visibility: auto;
  contain-intrinsic-size: auto 150px; */
  /* &.in_view {
    content-visibility: visible;
  } */
  &[data-highlight="true"] {
    background: #f5f6f7;
  }
  &.pinned {
    background: #ecfdff;
  }
  &:hover,
  &.contextVisible,
  &.preview {
    /* content-visibility: inherit;
    contain-intrinsic-size: inherit; */
    background: #f5f6f7;
    .cmds {
      visibility: visible;
    }
  }
  &.readonly:hover {
    background: none;
  }
  > .avatar {
    flex-shrink: 0;
    cursor: pointer;
    width: 40px;
    height: 40px;
    img {
      object-fit: cover;
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
  }
  > .details {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 8px;
    .up {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      .name {
        color: #06b6d4;
        font-style: normal;
        font-size: 14px;
        line-height: 20px;
      }
      .time {
        color: #bfbfbf;
        font-size: 12px;
        line-height: 18px;
      }
    }
    .down {
      user-select: text;
      color: #374151;
      font-weight: normal;
      font-size: 14px;
      line-height: 20px;
      word-break: break-all;
      white-space: pre-wrap;
      .edited {
        margin-left: 5px;
        color: #999;
        font-size: 10px;
      }
      &.sending {
        opacity: 0.9;
      }
      .img {
        max-width: 480px;
        cursor: pointer;
      }
      > .link {
        text-decoration: none;
        border-radius: 2px;
        /* background-color: #f5feff; */
        padding: 2px;
        color: #1fe1f9;
      }
    }
  }
  &.archive {
    gap: 8px;
    .avatar {
      width: 24px;
      height: 24px;
    }
    > .details {
      gap: 0;
      .up .name {
        font-weight: 600;
        color: #475467;
      }
      .down {
        color: #475467;
      }
    }
  }
  &.pinned {
    padding-top: 26px;
    > .details {
      position: relative;
      &:before {
        position: absolute;
        left: 0;
        top: -4px;
        transform: translateY(-100%);
        content: attr(data-pin-tip);
        font-weight: 400;
        font-size: 12px;
        line-height: 18px;
        color: #98a2b3;
      }
    }
  }
`},9083:(e,t,i)=>{i.d(t,{Z:()=>p});var n=i(7313),s=(i(6081),i(5185),i(4334)),r=i.n(s),a=i(7072),o=i(9184),l=i(3487),c=i(6417);const d=o.ZP.div`
  * {
    user-select: text;
  }
  .toastui-editor-contents {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
`;function p(e){let{content:t}=e;const i=(0,n.useRef)(null),[s,o]=(0,n.useState)(null);(0,n.useEffect)((()=>{if(i){i.current.addEventListener("click",(e=>{e.stopPropagation();const{target:t}=e;if("IMG"==t.nodeName){const e=new URL(t.src),i=`${e.origin}${e.pathname}?file_path=${e.searchParams.get("file_path")}`;o({originUrl:i})}}),!0)}}),[]);return(0,c.jsxs)(c.Fragment,{children:[s&&(0,c.jsx)(l.Z,{download:!1,data:s,closeModal:()=>{o(null)}}),(0,c.jsx)(d,{ref:i,children:(0,c.jsx)(a.A,{initialValue:t,plugins:[r()]})})]})}},5664:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(7313),s=i(3709),r=i(5843);function a(e){let{cid:t=null,uid:i=null}=e;const[a]=(0,r.DJ)(),[o]=(0,r.mK)(),[l,c]=(0,n.useState)([]),{favs:d=[]}=(0,s.v9)((e=>({favs:e.favorites})));return(0,n.useEffect)((()=>{let e=[];e=t?d.filter((e=>!!e.messages&&e.messages.every((e=>e.source.gid==t)))):d,e=i?e.filter((e=>!!e.messages&&e.messages.every((e=>e.source.uid==i)))):e,c(e)}),[t,i,d]),{isFavorited:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!e)return!1;let t=[];return l.forEach((e=>{if(1==e.messages.length){const i=e.messages.map((e=>e.from_mid));t=[...t,...i]}})),t.findIndex((t=>t==e))>-1},addFavorite:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=Array.isArray(e)?e.map((e=>+e)):[+e];if(0==t.length)return;const{error:i=null}=await o(t);return!i},removeFavorite:e=>{e&&a(e)},favorites:l}}},1958:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(7313),s=i(4711),r=i(5843);function a(){const[e,t]=(0,n.useState)(null),[i,a]=(0,n.useState)(null),[o,{data:l,isError:c,isLoading:d,isSuccess:p}]=(0,r.uv)();(0,n.useEffect)((()=>{if(l&&p){const t=(0,s.Hr)(l,e);a(t)}}),[l,p,e]),(0,n.useEffect)((()=>{e&&o(e)}),[e]);return{normalizeMessage:e=>{t(e)},messages:i,isError:c,isLoading:d,isSuccess:p}}},6475:(e,t,i)=>{i.d(t,{Z:()=>c});var n=i(3247),s=i(5564),r=i(6432),a=i(5843),o=i(3709),l=i(3657);function c(e){const{context:t="user",from:i=null,to:c=null}=e||{},d=(0,o.I0)(),p=(0,o.v9)((e=>e.ui.uploadFiles[`${t}_${c}`]||[])),[f,{isError:u,isLoading:h,isSuccess:x}]=(0,a.qt)(),[g,{isLoading:m,isSuccess:v,isError:w}]=(0,s.R4)(),[b,{isLoading:y,isSuccess:j,isError:_}]=(0,r.bm)(),k="user"==t?b:g,Z=()=>{d((0,n.XS)(`${t}_${c}`))};return{setReplying:e=>{0===p.length?d((0,n.MQ)({mid:e,key:`${t}_${c}`})):l.ZP.error("Only text is supported when replying a message")},removeReplying:Z,sendMessages:async e=>{let{type:t="text",content:i,users:n=[],channels:s=[]}=e;if(n.length)for await(const r of n)await b({type:t,id:r,content:i});if(s.length)for await(const r of s)await g({type:t,id:r,content:i})},sendMessage:async e=>{let{type:n="text",content:s,properties:r={},reply_mid:a=null,...o}=e;a?(Z(),await f({id:c,reply_mid:a,type:n,content:s,context:t,from_uid:i})):await k({id:c,content:s,properties:{...r},type:n,from_uid:i,...o})},isError:w||_||u,isSending:y||m||h,isSuccess:v||j||x}}},1808:(e,t,i)=>{i.d(t,{Z:()=>c});var n=i(7313),s=i(3709),r=i(5018),a=i(2867),o=i(5843),l=i(3657);function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{context:t="",id:i=""}=e,c=(0,s.I0)(),{stageFiles:d,replying:p}=(0,s.v9)((e=>({stageFiles:e.ui.uploadFiles[`${t}_${i}`]||[],replying:e.message.replying[`${t}_${i}`]}))),[f,u]=(0,n.useState)(null),h=(0,n.useRef)(!1),x=(0,n.useRef)(0),g=(0,n.useRef)(1),[m,{isLoading:v,isSuccess:w}]=(0,o.$_)(),[b,{isLoading:y,isSuccess:j,isError:_}]=(0,o.Yh)(),k=e=>{const{file_id:t,chunk:i,is_last:n}=e,s=new FormData;return s.append("file_id",t),s.append("chunk_data",i),s.append("chunk_is_last",n),b(s)},Z=async e=>{if(!e)return;u(null);const{name:t=`rustchat-${+new Date}.${e.type.split("/")[1]}`,type:i,size:n}=e,{data:s}=await m({content_type:i,filename:t});let r=null;if(h.current=!1,g.current=1,x.current=0,n<=2e6)r=await k({file_id:s,chunk:e,is_last:!0}),x.current=1;else{g.current=Math.ceil(n/a.Pb);const t=g.current,o=new Array(t);for await(const[n]of o.entries()){if(h.current)break;try{const t=e.slice(a.Pb*n,a.Pb*(n+1),i);r=await k({file_id:s,chunk:t,is_last:n==o.length-1}),x.current++}catch(f){return}}}const{data:{path:o,size:l,hash:c}}=r,d=encodeURIComponent(o),p={name:t,file_type:i,path:o,size:l,hash:c,url:`${a.ZP}/resource/file?file_path=${d}`,thumbnail:i.startsWith("image")?`${a.ZP}/resource/file?file_path=${d}&thumbnail=true`:"",download:`${a.ZP}/resource/file?file_path=${d}&download=true`};return u(p),p},N=()=>{h.current=!0},L=e=>{c((0,r.tD)({context:t,id:i,operation:"remove",index:e}))},C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p?l.ZP.error("Only text is supported when replying a message"):c((0,r.tD)({context:t,id:i,data:e}))},E=()=>{c((0,r.tD)({context:t,id:i,operation:"reset"}))},S=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c((0,r.tD)({context:t,id:i,operation:"update",index:e,...n}))};return{stopUploading:N,data:f,isUploading:v||y,progress:Number(x.current/g.current*100).toFixed(2),uploadFile:Z,isError:_,isSuccess:!!f,stageFiles:d,addStageFile:C,resetStageFiles:E,removeStageFile:L,updateStageFile:S}}}}]);